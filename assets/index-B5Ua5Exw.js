var Ce=s=>{throw TypeError(s)};var xe=(s,e,i)=>e.has(s)||Ce("Cannot "+i);var t=(s,e,i)=>(xe(s,e,"read from private field"),i?i.call(s):e.get(s)),a=(s,e,i)=>e.has(s)?Ce("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,i),r=(s,e,i,n)=>(xe(s,e,"write to private field"),n?n.call(s,i):e.set(s,i),i),x=(s,e,i)=>(xe(s,e,"access private method"),i);var le=(s,e,i,n)=>({set _(l){r(s,e,l,i)},get _(){return t(s,e,n)}});import{r as I,j as m,B as _e,M as He,A as Je}from"./index-CmXMr9Pl.js";import"./services-CCimaRqh.js";const Qe=()=>[1,0,0,0,1,0,0,0,1],oe=(s,e)=>{if(typeof e=="number")return s.forEach((i,n,l)=>l[n]=i*e),s;if(e.length===3)return[s[0]*e[0]+s[1]*e[1]+s[2]*e[2],s[3]*e[0]+s[4]*e[1]+s[5]*e[2],s[6]*e[0]+s[7]*e[1]+s[8]*e[2]];if(e.length/3==3)return[s[0]*e[0]+s[1]*e[3]+s[2]*e[6],s[0]*e[1]+s[1]*e[4]+s[2]*e[7],s[0]*e[2]+s[1]*e[5]+s[2]*e[8],s[3]*e[0]+s[4]*e[3]+s[5]*e[6],s[3]*e[1]+s[4]*e[4]+s[5]*e[7],s[3]*e[2]+s[4]*e[5]+s[5]*e[8],s[6]*e[0]+s[7]*e[3]+s[8]*e[6],s[6]*e[1]+s[7]*e[4]+s[8]*e[7],s[6]*e[2]+s[7]*e[5]+s[8]*e[8]];throw"Invalid array length."},he=(s,e)=>{if(e.length%3==0){let[i,n,l,u]=[0,0,0,0];const b=e.length/3;for(let Y=0;Y<b;Y++)u=3*Y,[i,n,l]=[e[0+u],e[1+u],e[2+u]],e[0+u]=s[0]*i+s[1]*n+s[2]*l,e[1+u]=s[3]*i+s[4]*n+s[5]*l,e[2+u]=s[6]*i+s[7]*n+s[8]*l}else throw"Invalid array length."};function Ze(s){s=Math.abs(parseInt(s));const e=Math.floor(s/36e5),i=Math.floor(s%36e5/6e4),n=Math.floor(s%6e4/1e3),l=s%1e3;return`${e}h ${i}m ${n}s ${l}ms`}var q,_;class Ve{constructor(){a(this,q,0);a(this,_,0)}step(e){return r(this,q,t(this,q)+e),r(this,_,t(this,_)+1),this}get(){return t(this,q)/t(this,_)}}q=new WeakMap,_=new WeakMap;var H;class Pe{constructor(){a(this,H,!1)}frame(e,i){throw"TODO Override!"}render(e,i){return this.frame(e,i),!t(this,H)}remove(){r(this,H,!0)}}H=new WeakMap;var J,Q,Z;class Fe{constructor(e,i,n){a(this,J);a(this,Q);a(this,Z);r(this,J,e),r(this,Q,i),r(this,Z,n)}getVerts(){return Array.from(t(this,J))}getEdges(){return Array.from(t(this,Q))}getFaces(){return Array.from(t(this,Z))}}J=new WeakMap,Q=new WeakMap,Z=new WeakMap;var B,k,O,de,$,z;class Be extends Pe{constructor(i,n,l,u,b){super();a(this,B);a(this,k);a(this,O);a(this,de);a(this,$,"30px Tiny5");a(this,z,"black");r(this,B,typeof i=="function"?i:()=>i),r(this,k,n),r(this,O,l),r(this,$,u!==void 0?u:t(this,$)),r(this,z,b!==void 0?b:t(this,z))}frame(i,n){n.drawUiText(t(this,B).call(this),t(this,k),t(this,O),t(this,$),t(this,z))}setPosition(i,n,l){return[le(this,k)._,le(this,O)._,le(this,de)._]=[i,n,l],this}}B=new WeakMap,k=new WeakMap,O=new WeakMap,de=new WeakMap,$=new WeakMap,z=new WeakMap;const Re=(s,e,i,n,l)=>new Be(s,e,i,n,l),Ae=2*Math.PI;var f,h,w,T,C,A,y,V,G,E,P,K,X,ee,S,F,D,te,R,N,j,M,d,be,Le,Ie,W,ke,ve,Oe;class et{constructor(e=null){a(this,d);a(this,f);a(this,h);a(this,w);a(this,T);a(this,C);a(this,A);a(this,y);a(this,V);a(this,G,!0);a(this,E);a(this,P);a(this,K);a(this,X);a(this,ee);a(this,S);a(this,F);a(this,D);a(this,te);a(this,R);a(this,N);a(this,j);a(this,M);r(this,f,e),r(this,h,t(this,f).getContext("2d")),x(this,d,be).call(this)}start(){return console.log("Start render engine."),r(this,T,!0),r(this,E,new Ve),r(this,S,0),r(this,V,performance.now()),t(this,G)&&this.showFpsDebug(),requestAnimationFrame(this.frame.bind(this)),this}pause(){return console.log("Pause render engine."),r(this,T,!1),this}stop(){return console.log("Stop render engine."),r(this,C,!0),this}frame(e){r(this,y,e-t(this,V)),r(this,V,e),t(this,G)&&x(this,d,ke).call(this),x(this,d,Ie).call(this),x(this,d,Le).call(this),t(this,T)&&t(this,C)===!1?requestAnimationFrame(this.frame.bind(this)):(t(this,G)&&x(this,d,Oe).call(this),t(this,C)!==!1&&x(this,d,be).call(this))}moveCameraTo(e){t(this,N)[2]=e[0],t(this,N)[5]=e[1],x(this,d,W).call(this)}translateCameraBy(e){r(this,N,oe(t(this,N),[1,0,-e[0],0,1,-e[1],0,0,e[2]])),x(this,d,W).call(this)}getCameraMat(){return t(this,N)}getCanvasMat(){return t(this,j)}getViewportSize(){return[t(this,f).width,t(this,f).height]}getCanvasSize(){return[t(this,f).width,t(this,f).height]}render(e){return typeof e=="object"&&typeof e.render!==void 0&&typeof e.render=="function"?t(this,w).push(e.render.bind(e)):typeof e=="function"&&t(this,w).push(e),this}drawExample(){this.render(new tt)}drawMesh(e){const i=e.getVerts();he(t(this,M),i),t(this,h).beginPath(),t(this,h).moveTo(i[0],i[1]);const n=i.length/3;for(let l=1;l<n;l++)t(this,h).lineTo(i[0+3*l],i[1+3*l]);t(this,h).closePath(),t(this,h).fillStyle="blue",t(this,h).fill(),t(this,h).strokeStyle="black",t(this,h).stroke()}drawUiText(e,i,n,l,u){[i,n]=oe(t(this,j),[i,n,1]),t(this,h).font=l,t(this,h).fillStyle=u,t(this,h).fillText(e,i,n)}drawPoints(e){const i=e.getVerts();he(t(this,M),i);const n=i.length/3;for(let l=0;l<n;l++)t(this,h).beginPath(),t(this,h).arc(i[0+3*l],i[1+3*l],1,0,Ae),t(this,h).stroke()}drawVector(e){const i=Array.from(e);he(t(this,M),i);const n=oe(t(this,M),[0,0,1]),l=i.length/3;for(let u=0;u<l;u++)t(this,h).beginPath(),t(this,h).moveTo(n[0],n[1]),t(this,h).lineTo(i[0+3*u],i[1+3*u]),t(this,h).closePath(),t(this,h).stroke()}onResize(e,i){t(this,f).width=e,t(this,f).height=i,r(this,j,[1,0,0,0,-1,t(this,f).height,0,0,1]),x(this,d,W).call(this),t(this,G)&&this.showFpsDebug()}showFpsDebug(e,i,n){this.hideFpsDebug(),this.fpsDebugTextBox=Re((()=>`FPS: ${t(this,R)}`).bind(this),t(this,f).width-125,15),this.render(this.fpsDebugTextBox)}hideFpsDebug(){this.fpsDebugTextBox!==void 0&&this.fpsDebugTextBox.remove()}}f=new WeakMap,h=new WeakMap,w=new WeakMap,T=new WeakMap,C=new WeakMap,A=new WeakMap,y=new WeakMap,V=new WeakMap,G=new WeakMap,E=new WeakMap,P=new WeakMap,K=new WeakMap,X=new WeakMap,ee=new WeakMap,S=new WeakMap,F=new WeakMap,D=new WeakMap,te=new WeakMap,R=new WeakMap,N=new WeakMap,j=new WeakMap,M=new WeakMap,d=new WeakSet,be=function(){r(this,w,[]),r(this,T,!1),r(this,C,!1),r(this,A,"rgb(255, 255, 255)"),r(this,y,0),r(this,V,0),r(this,E,null),r(this,K,0),r(this,X,0),r(this,P,0),r(this,ee,6e4),r(this,S,0),r(this,F,0),r(this,D,0),r(this,te,5e3),r(this,R,0),r(this,N,Qe()),r(this,j,[1,0,0,0,-1,t(this,f).height,0,0,1]),x(this,d,W).call(this)},Le=function(){const e=t(this,w);r(this,w,[]);let i=null;for(;i=e.shift();)i(t(this,y),this)===!0&&t(this,w).push(i);return this},Ie=function(){return t(this,h).fillStyle=t(this,A),t(this,h).fillRect(0,0,t(this,f).width,t(this,f).height),this},W=function(){r(this,M,oe(t(this,j),t(this,N)))},ke=function(){r(this,K,t(this,K)+t(this,y)),r(this,X,t(this,X)+1),t(this,E).step(t(this,y)),x(this,d,ve).call(this),t(this,S)>t(this,ee)?(r(this,P,parseInt(t(this,E).get())),r(this,S,0),r(this,E,new Ve),console.log(`Average delta: ${t(this,P)} ms`)):r(this,S,t(this,S)+t(this,y))},ve=function(){t(this,D)>t(this,te)?(r(this,R,parseInt(t(this,F)/t(this,D)*1e3)),r(this,F,0),r(this,D,0),console.log("FPS:",t(this,R))):(r(this,F,t(this,F)+1),r(this,D,t(this,D)+t(this,y)))},Oe=function(){x(this,d,ve).call(this),console.log(`Average delta: ${t(this,P)} ms`),console.log(`Total, frames: ${t(this,X)}, render time: ${Ze(t(this,K))}`)};var se;class tt extends Pe{constructor(){super();a(this,se);const i=[25,25,1,125,25,1,75,125,1];he([1,0,200,0,1,100,0,0,1],i),r(this,se,new Fe(i))}frame(i,n){n.drawMesh(t(this,se))}}se=new WeakMap;const Ge="Experimental Canvas Graphics";let c=null;const nt=()=>{const[s,e]=I.useState(!0),[i,n]=I.useState(!0),l=I.useRef(null),u=I.useRef(null);I.useEffect(()=>{document.title=Ge},[]),I.useLayoutEffect(()=>{let ye=l.current,v=u.current;c=new et(v),c.start(),c.drawExample();const Ne=(o,p=performance.now(),U=0)=>{const me=new He(p),ae=[];for(let pe=0;pe<o+U;pe++)pe>=U?ae.push(me.rnd()):me.rnd();return ae},we=2**32,ue=128,$e=Ne(ue,Math.random()*we),ze=Ne(ue,Math.random()*we),[Ke,Xe]=[20,250],[Ye,Ue]=[600,150];let g=null,Ee=[];for(let o=0;o<ue;o++)g={x:$e[o],y:ze[o]},g.x=Ye*g.x,g.y=Ue*g.y,g.x=Ke+g.x,g.y=Xe+g.y,Ee.push(g.x,g.y,1);const We=new Fe(Ee);c.render((o,p)=>(p.drawPoints(We),!0)),c.render((o,p)=>(p.drawVector([128,128,1,128,256,1]),!0));let ce=0;const qe=3e3,Se=Re("Hello, 2D Canvas!",0,0);c.render(Se),c.render(((o,p,U)=>(ce>=qe?(ce=0,o.setPosition(Math.random()*(v.width-150),Math.random()*(v.height-100))):ce+=p,!0)).bind(null,Se));const ie=4,re=20,De=o=>{o.altKey||o.ctrlKey||o.metaKey||(o.code==="ArrowLeft"&&c.translateCameraBy([1*(o.shiftKey?re:ie),0,1]),o.code==="ArrowRight"&&c.translateCameraBy([-1*(o.shiftKey?re:ie),0,1]),o.code==="ArrowUp"&&c.translateCameraBy([0,-1*(o.shiftKey?re:ie),1]),o.code==="ArrowDown"&&c.translateCameraBy([0,1*(o.shiftKey?re:ie),1]),o.code==="Enter"&&console.log("enter pressed"))};let L=null,fe=!1;const je=o=>{fe=!0,L=o,document.body.style.cursor="move"},ne=o=>{fe=!1,L=null,document.body.style.cursor="default"},Me=o=>{if(!(fe&&L))return;const p=L.clientX-o.clientX,U=o.clientY-L.clientY;L=o,c.render((me,ae)=>(ae.translateCameraBy([p,U,1]),!1))},Te=new ResizeObserver(o=>{const p=o[0].contentRect;c&&c.onResize(p.width,p.height)});return Te.observe(ye),document.body.addEventListener("keydown",De),v.addEventListener("mousedown",je),v.addEventListener("mouseup",ne),v.addEventListener("mouseleave",ne),v.addEventListener("mousemove",Me),()=>{c&&(c.stop(),c=null),Te.unobserve(ye),document.body.removeEventListener("keydown",De),v.removeEventListener("mousedown",je),v.removeEventListener("mouseup",ne),v.removeEventListener("mouseleave",ne),v.removeEventListener("mousemove",Me)}},[]);const b="my-2 mx-1 px-2 py-1 bg-blue-500 text-xl text-white rounded-md hover:bg-blue-600 active:bg-blue-700 disabled:bg-neutral-400",Y=i?"fixed inset-0 w-screen h-screen":"flex-1 self-stretch border-2 border-gray-700";let ge=m.jsxDEV("div",{className:"absolute top-1 right-1",children:[m.jsxDEV(Je,{className:b,appid:"default",children:"Main App"},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:229,columnNumber:3},void 0),i?m.jsxDEV("button",{className:b,onClick:()=>n(!1),children:"Exit Fullscreen ⬇"},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:231,columnNumber:17},void 0):m.jsxDEV("button",{className:b,onClick:()=>n(!0),children:"Fullscreen ↕"},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:232,columnNumber:6},void 0),s?m.jsxDEV("button",{className:b,onClick:()=>{e(!s),c.pause()},children:"Pause ⏸"},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:234,columnNumber:12},void 0):m.jsxDEV("button",{className:b,onClick:()=>{e(!s),c.start()},children:"Play ▶"},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:235,columnNumber:6},void 0),m.jsxDEV("button",{className:b,onClick:()=>c.stop(),children:"Stop ⏹"},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:237,columnNumber:3},void 0),m.jsxDEV("br",{},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:239,columnNumber:3},void 0),m.jsxDEV("button",{className:b,onClick:()=>console.log("TODO Run tests!"),children:"Run Tests (TODO)"},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:241,columnNumber:3},void 0)]},void 0,!0,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:228,columnNumber:21},void 0);return m.jsxDEV(_e,{children:m.jsxDEV("div",{className:"h-full flex flex-col items-center",children:[m.jsxDEV("h2",{className:"m-4 text-4xl text-center",children:Ge},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:246,columnNumber:4},void 0),m.jsxDEV("div",{className:"mb-4 text-3xl",children:ge},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:247,columnNumber:4},void 0),m.jsxDEV("div",{ref:l,className:Y,children:[m.jsxDEV("canvas",{ref:u,className:i?" absolute inset-0":null},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:251,columnNumber:5},void 0),i?ge:null]},void 0,!0,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:250,columnNumber:4},void 0)]},void 0,!0,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:245,columnNumber:3},void 0)},void 0,!1,{fileName:"/apps/user-friendly.dev/src/Standalone/Graphics/index.jsx",lineNumber:244,columnNumber:10},void 0)};export{Ge as PAGE_TITLE,nt as default};
