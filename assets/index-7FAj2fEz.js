var Ft=s=>{throw TypeError(s)};var gt=(s,t,i)=>t.has(s)||Ft("Cannot "+i);var e=(s,t,i)=>(gt(s,t,"read from private field"),i?i.call(s):t.get(s)),h=(s,t,i)=>t.has(s)?Ft("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,i),r=(s,t,i,n)=>(gt(s,t,"write to private field"),n?n.call(s,i):t.set(s,i),i),g=(s,t,i)=>(gt(s,t,"access private method"),i);var ot=(s,t,i,n)=>({set _(o){r(s,t,o,i)},get _(){return e(s,t,n)}});import{r as O,j as m,B as _t,M as Ht,A as Jt}from"./index-tpZYpWNX.js";import"./services-CCimaRqh.js";const Qt=()=>[1,0,0,0,1,0,0,0,1],at=(s,t)=>{if(typeof t=="number")return s.forEach((i,n,o)=>o[n]=i*t),s;if(t.length===3)return[s[0]*t[0]+s[1]*t[1]+s[2]*t[2],s[3]*t[0]+s[4]*t[1]+s[5]*t[2],s[6]*t[0]+s[7]*t[1]+s[8]*t[2]];if(t.length/3==3)return[s[0]*t[0]+s[1]*t[3]+s[2]*t[6],s[0]*t[1]+s[1]*t[4]+s[2]*t[7],s[0]*t[2]+s[1]*t[5]+s[2]*t[8],s[3]*t[0]+s[4]*t[3]+s[5]*t[6],s[3]*t[1]+s[4]*t[4]+s[5]*t[7],s[3]*t[2]+s[4]*t[5]+s[5]*t[8],s[6]*t[0]+s[7]*t[3]+s[8]*t[6],s[6]*t[1]+s[7]*t[4]+s[8]*t[7],s[6]*t[2]+s[7]*t[5]+s[8]*t[8]];throw"Invalid array length."},lt=(s,t)=>{if(t.length%3==0){let[i,n,o,u]=[0,0,0,0];const x=t.length/3;for(let G=0;G<x;G++)u=3*G,[i,n,o]=[t[0+u],t[1+u],t[2+u]],t[0+u]=s[0]*i+s[1]*n+s[2]*o,t[1+u]=s[3]*i+s[4]*n+s[5]*o,t[2+u]=s[6]*i+s[7]*n+s[8]*o}else throw"Invalid array length."};function Zt(s){s=Math.abs(parseInt(s));const t=Math.floor(s/36e5),i=Math.floor(s%36e5/6e4),n=Math.floor(s%6e4/1e3),o=s%1e3;return`${t}h ${i}m ${n}s ${o}ms`}var q,_;class Rt{constructor(){h(this,q,0);h(this,_,0)}step(t){return r(this,q,e(this,q)+t),r(this,_,e(this,_)+1),this}get(){return e(this,q)/e(this,_)}}q=new WeakMap,_=new WeakMap;var H;class Lt{constructor(){h(this,H,!1)}frame(t,i){throw"TODO Override!"}render(t,i){return this.frame(t,i),!e(this,H)}remove(){r(this,H,!0)}}H=new WeakMap;var J,Q,Z;class Nt{constructor(t,i,n){h(this,J);h(this,Q);h(this,Z);r(this,J,t),r(this,Q,i),r(this,Z,n)}getVerts(){return Array.from(e(this,J))}getEdges(){return Array.from(e(this,Q))}getFaces(){return Array.from(e(this,Z))}}J=new WeakMap,Q=new WeakMap,Z=new WeakMap;var B,$,z,ct,K,V;class Bt extends Lt{constructor(i,n,o,u,x){super();h(this,B);h(this,$);h(this,z);h(this,ct);h(this,K,"30px Tiny5");h(this,V,"black");r(this,B,typeof i=="function"?i:()=>i),r(this,$,n),r(this,z,o),r(this,K,u!==void 0?u:e(this,K)),r(this,V,x!==void 0?x:e(this,V))}frame(i,n){n.drawUiText(e(this,B).call(this),e(this,$),e(this,z),e(this,K),e(this,V))}setPosition(i,n,o){return[ot(this,$)._,ot(this,z)._,ot(this,ct)._]=[i,n,o],this}}B=new WeakMap,$=new WeakMap,z=new WeakMap,ct=new WeakMap,K=new WeakMap,V=new WeakMap;const It=(s,t,i,n,o)=>new Bt(s,t,i,n,o),At=2*Math.PI;var f,l,M,P,F,A,b,R,j,T,L,X,Y,tt,E,N,C,et,I,v,S,D,c,xt,kt,Ot,W,$t,yt,zt;class te{constructor(t=null){h(this,c);h(this,f);h(this,l);h(this,M);h(this,P);h(this,F);h(this,A);h(this,b);h(this,R);h(this,j,!0);h(this,T);h(this,L);h(this,X);h(this,Y);h(this,tt);h(this,E);h(this,N);h(this,C);h(this,et);h(this,I);h(this,v);h(this,S);h(this,D);r(this,f,t),r(this,l,e(this,f).getContext("2d")),g(this,c,xt).call(this)}start(){return console.log("Start render engine."),r(this,P,!0),r(this,T,new Rt),r(this,E,0),r(this,R,performance.now()),e(this,j)&&this.showFpsDebug(),requestAnimationFrame(this.frame.bind(this)),this}pause(){return console.log("Pause render engine."),r(this,P,!1),this}stop(){return console.log("Stop render engine."),r(this,F,!0),this}frame(t){r(this,b,t-e(this,R)),r(this,R,t),e(this,j)&&g(this,c,$t).call(this),g(this,c,Ot).call(this),g(this,c,kt).call(this),e(this,P)&&e(this,F)===!1?requestAnimationFrame(this.frame.bind(this)):(e(this,j)&&g(this,c,zt).call(this),e(this,F)!==!1&&g(this,c,xt).call(this))}moveCameraTo(t){e(this,v)[2]=t[0],e(this,v)[5]=t[1],g(this,c,W).call(this)}translateCameraBy(t){r(this,v,at(e(this,v),[1,0,-t[0],0,1,-t[1],0,0,t[2]])),g(this,c,W).call(this)}getCameraMat(){return e(this,v)}getCanvasMat(){return e(this,S)}getViewportSize(){return[e(this,f).width,e(this,f).height]}getCanvasSize(){return[e(this,f).width,e(this,f).height]}render(t){return typeof t=="object"&&typeof t.render!==void 0&&typeof t.render=="function"?e(this,M).push(t.render.bind(t)):typeof t=="function"&&e(this,M).push(t),this}drawExample(){this.render(new ee)}drawMesh(t){const i=t.getVerts();lt(e(this,D),i),e(this,l).beginPath(),e(this,l).moveTo(i[0],i[1]);const n=i.length/3;for(let o=1;o<n;o++)e(this,l).lineTo(i[0+3*o],i[1+3*o]);e(this,l).closePath(),e(this,l).fillStyle="blue",e(this,l).fill(),e(this,l).strokeStyle="black",e(this,l).stroke()}drawUiText(t,i,n,o,u){[i,n]=at(e(this,S),[i,n,1]),e(this,l).font=o,e(this,l).fillStyle=u,e(this,l).fillText(t,i,n)}drawPoints(t){const i=t.getVerts();lt(e(this,D),i);const n=i.length/3;for(let o=0;o<n;o++)e(this,l).beginPath(),e(this,l).arc(i[0+3*o],i[1+3*o],1,0,At),e(this,l).stroke()}drawVector(t){const i=Array.from(t);lt(e(this,D),i);const n=at(e(this,D),[0,0,1]),o=i.length/3;for(let u=0;u<o;u++)e(this,l).beginPath(),e(this,l).moveTo(n[0],n[1]),e(this,l).lineTo(i[0+3*u],i[1+3*u]),e(this,l).closePath(),e(this,l).stroke()}onResize(t,i){e(this,f).width=t,e(this,f).height=i,r(this,S,[1,0,0,0,-1,e(this,f).height,0,0,1]),g(this,c,W).call(this),e(this,j)&&this.showFpsDebug()}showFpsDebug(t,i,n){this.hideFpsDebug(),this.fpsDebugTextBox=It((()=>`FPS: ${e(this,I)}`).bind(this),e(this,f).width-125,15),this.render(this.fpsDebugTextBox)}hideFpsDebug(){this.fpsDebugTextBox!==void 0&&this.fpsDebugTextBox.remove()}}f=new WeakMap,l=new WeakMap,M=new WeakMap,P=new WeakMap,F=new WeakMap,A=new WeakMap,b=new WeakMap,R=new WeakMap,j=new WeakMap,T=new WeakMap,L=new WeakMap,X=new WeakMap,Y=new WeakMap,tt=new WeakMap,E=new WeakMap,N=new WeakMap,C=new WeakMap,et=new WeakMap,I=new WeakMap,v=new WeakMap,S=new WeakMap,D=new WeakMap,c=new WeakSet,xt=function(){r(this,M,[]),r(this,P,!1),r(this,F,!1),r(this,A,"rgb(255, 255, 255)"),r(this,b,0),r(this,R,0),r(this,T,null),r(this,X,0),r(this,Y,0),r(this,L,0),r(this,tt,6e4),r(this,E,0),r(this,N,0),r(this,C,0),r(this,et,5e3),r(this,I,0),r(this,v,Qt()),r(this,S,[1,0,0,0,-1,e(this,f).height,0,0,1]),g(this,c,W).call(this)},kt=function(){const t=e(this,M);r(this,M,[]);let i=null;for(;i=t.shift();)i(e(this,b),this)===!0&&e(this,M).push(i);return this},Ot=function(){return e(this,l).fillStyle=e(this,A),e(this,l).fillRect(0,0,e(this,f).width,e(this,f).height),this},W=function(){r(this,D,at(e(this,S),e(this,v)))},$t=function(){r(this,X,e(this,X)+e(this,b)),r(this,Y,e(this,Y)+1),e(this,T).step(e(this,b)),g(this,c,yt).call(this),e(this,E)>e(this,tt)?(r(this,L,parseInt(e(this,T).get())),r(this,E,0),r(this,T,new Rt),console.log(`Average delta: ${e(this,L)} ms`)):r(this,E,e(this,E)+e(this,b))},yt=function(){e(this,C)>e(this,et)?(r(this,I,parseInt(e(this,N)/e(this,C)*1e3)),r(this,N,0),r(this,C,0),console.log("FPS:",e(this,I))):(r(this,N,e(this,N)+1),r(this,C,e(this,C)+e(this,b)))},zt=function(){g(this,c,yt).call(this),console.log(`Average delta: ${e(this,L)} ms`),console.log(`Total, frames: ${e(this,Y)}, render time: ${Zt(e(this,X))}`)};var st;class ee extends Lt{constructor(){super();h(this,st);const i=[25,25,1,125,25,1,75,125,1];lt([1,0,200,0,1,100,0,0,1],i),r(this,st,new Nt(i))}frame(i,n){n.drawMesh(e(this,st))}}st=new WeakMap;const jt="Experimental Canvas Graphics";let d=null;const ne=()=>{const[s,t]=O.useState(!0),[i,n]=O.useState(!0),o=O.useRef(null),u=O.useRef(null);O.useEffect(()=>{document.title=jt},[]),O.useLayoutEffect(()=>{let bt=o.current,y=u.current;d=new te(y),d.start(),d.drawExample();const vt=(a,p=performance.now(),U=0)=>{const mt=new Ht(p),ht=[];for(let pt=0;pt<a+U;pt++)pt>=U?ht.push(mt.rnd()):mt.rnd();return ht},Mt=2**32,ut=128,Kt=vt(ut,Math.random()*Mt),Vt=vt(ut,Math.random()*Mt),[Xt,Yt]=[20,250],[Gt,Ut]=[600,150];let w=null,Tt=[];for(let a=0;a<ut;a++)w={x:Kt[a],y:Vt[a]},w.x=Gt*w.x,w.y=Ut*w.y,w.x=Xt+w.x,w.y=Yt+w.y,Tt.push(w.x,w.y,1);const Wt=new Nt(Tt);d.render((a,p)=>(p.drawPoints(Wt),!0)),d.render((a,p)=>(p.drawVector([128,128,1,128,256,1]),!0));let dt=0;const qt=3e3,Et=It("Hello, 2D Canvas!",0,0);d.render(Et),d.render(((a,p,U)=>(dt>=qt?(dt=0,a.setPosition(Math.random()*(y.width-150),Math.random()*(y.height-100))):dt+=p,!0)).bind(null,Et));const it=4,rt=20,Ct=a=>{a.altKey||a.ctrlKey||a.metaKey||(a.code==="ArrowLeft"&&d.translateCameraBy([1*(a.shiftKey?rt:it),0,1]),a.code==="ArrowRight"&&d.translateCameraBy([-1*(a.shiftKey?rt:it),0,1]),a.code==="ArrowUp"&&d.translateCameraBy([0,-1*(a.shiftKey?rt:it),1]),a.code==="ArrowDown"&&d.translateCameraBy([0,1*(a.shiftKey?rt:it),1]),a.code==="Enter"&&console.log("enter pressed"))};let k=null,ft=!1;const St=a=>{ft=!0,k=a,document.body.style.cursor="move"},nt=a=>{ft=!1,k=null,document.body.style.cursor="default"},Dt=a=>{if(!(ft&&k))return;const p=k.clientX-a.clientX,U=a.clientY-k.clientY;k=a,d.render((mt,ht)=>(ht.translateCameraBy([p,U,1]),!1))},Pt=new ResizeObserver(a=>{const p=a[0].contentRect;d&&d.onResize(p.width,p.height)});return Pt.observe(bt),document.body.addEventListener("keydown",Ct),y.addEventListener("mousedown",St),y.addEventListener("mouseup",nt),y.addEventListener("mouseleave",nt),y.addEventListener("mousemove",Dt),()=>{d&&(d.stop(),d=null),Pt.unobserve(bt),document.body.removeEventListener("keydown",Ct),y.removeEventListener("mousedown",St),y.removeEventListener("mouseup",nt),y.removeEventListener("mouseleave",nt),y.removeEventListener("mousemove",Dt)}},[]);const x="my-2 mx-1 px-2 py-1 bg-blue-500 text-xl text-white rounded-md hover:bg-blue-600 active:bg-blue-700 disabled:bg-neutral-400",G=i?"fixed inset-0 w-screen h-screen":"flex-1 self-stretch border-2 border-gray-700";let wt=m.jsxs("div",{className:"absolute top-1 right-1",children:[m.jsx(Jt,{className:x,appid:"default",children:"Main App"}),i?m.jsx("button",{className:x,onClick:()=>n(!1),children:"Exit Fullscreen ⬇"}):m.jsx("button",{className:x,onClick:()=>n(!0),children:"Fullscreen ↕"}),s?m.jsx("button",{className:x,onClick:()=>{t(!s),d.pause()},children:"Pause ⏸"}):m.jsx("button",{className:x,onClick:()=>{t(!s),d.start()},children:"Play ▶"}),m.jsx("button",{className:x,onClick:()=>d.stop(),children:"Stop ⏹"}),m.jsx("br",{}),m.jsx("button",{className:x,onClick:()=>console.log("TODO Run tests!"),children:"Run Tests (TODO)"})]});return m.jsx(_t,{children:m.jsxs("div",{className:"h-full flex flex-col items-center",children:[m.jsx("h2",{className:"m-4 text-4xl text-center",children:jt}),m.jsx("div",{className:"mb-4 text-3xl",children:wt}),m.jsxs("div",{ref:o,className:G,children:[m.jsx("canvas",{ref:u,className:i?" absolute inset-0":null}),i?wt:null]})]})})};export{jt as PAGE_TITLE,ne as default};
